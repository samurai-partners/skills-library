---
name: trend-detection
description: チャンネル・動画の成長トレンドや異常値を検出する。「トレンド」「伸びてる」「急上昇」「異常値」「変化を検出」「推移を見て」と言われたときに使用する。
allowed-tools: Read Grep Glob
---

# トレンド検出スキル

日次スナップショットデータから成長トレンド・急上昇・急落・異常値を検出し、早期にアクションすべきポイントを特定する。

## いつ使うか

- チャンネル全体の成長傾向を確認したいとき
- 特定の動画が急に伸び始めた/落ちた理由を知りたいとき
- 定期的な健康診断として
- 異常な数値変動を検出したいとき

## いつ使わないか

- 動画の内容・タイトル分析 → video-performance を使う
- 1本の動画の詳細分析のみ

## 手順

### Step 1: データ取得

**チャンネル全体の推移 (週次)**:
```
get_snapshots(channel_id=対象, start_date=90日前, granularity=weekly, include_deltas=true, include_cumulative=true)
```

**日次の細かい変動 (直近30日)**:
```
get_snapshots(channel_id=対象, start_date=30日前, granularity=daily, include_deltas=true, moving_average=7)
```

**動画別の推移**:
```
get_snapshots(video_id=対象動画ID, start_date=30日前, granularity=daily, include_deltas=true)
```

**比較用の動画一覧**:
```
get_videos(channel_id=対象, limit=50, sort_by=published_at, sort_order=desc)
```

取得時のポイント:
- `moving_average=7` を指定すると7日間移動平均が付与され、ノイズを除去できる
- `include_cumulative=true` で累積値を見ると長期トレンドが分かる
- `granularity=weekly` で週次集約すると中期トレンドが明確になる

### Step 2: 分析

#### 2-1. 成長トレンド判定

週次データの `views_delta_sum` (週間再生増分) の推移から、チャンネルの成長フェーズを判定:

| フェーズ | 条件 | 意味 |
|---|---|---|
| 急成長 | 前月比 +30% 以上 | アルゴリズム推奨やバズが発生中 |
| 安定成長 | 前月比 +5〜30% | 健全な成長軌道 |
| 横ばい | 前月比 -5〜+5% | 現状維持。新しい施策が必要 |
| 下降 | 前月比 -5% 以下 | 原因特定と対策が急務 |

#### 2-2. 異常値検出

日次データで以下のパターンを検出:

- **スパイク**: 7日間移動平均の2倍以上の日次再生数 → バズの可能性
- **急落**: 7日間移動平均の50%以下の日次再生数 → 問題の可能性
- **トレンド変化点**: 移動平均の傾きが正→負 or 負→正に変わったポイント

検出したら:
1. 該当日に公開された動画を確認
2. 外部要因 (祝日、イベント、トレンド) の可能性を検討
3. 対応の緊急度を判定

#### 2-3. 動画別成長ランキング

直近30日の再生数増分で動画をランキング:
- 古い動画が急に伸びている = evergreen or 外部流入
- 新しい動画の初速が過去動画より高い/低い = コンテンツ品質の変化

#### 2-4. 期間比較

スナップショットの期間比較機能を活用:
- 前半期 vs 後半期の成長率変化
- 前月 vs 今月の主要指標比較

### Step 3: 出力

```markdown
## トレンド検出レポート: [チャンネル名]

### サマリー
- 分析期間: [開始日] 〜 [終了日]
- 成長フェーズ: [急成長 / 安定成長 / 横ばい / 下降]
- 前月比: 再生数 [+X%] / いいね [+X%] / コメント [+X%]

### 成長トレンド
[週次の再生数推移データ]

| 週 | 再生増分 | 前週比 | トレンド |
|---|---|---|---|

### 異常値・注目ポイント
| 日付 | 種類 | 値 | 推定原因 |
|---|---|---|---|
| YYYY-MM-DD | スパイク | +XXX% | [動画タイトル] がバズ |
| YYYY-MM-DD | 急落 | -XX% | [推定原因] |

### 動画別 直近30日の成長ランキング
| 順位 | 動画 | 30日間再生増分 | 公開日 | 備考 |
|---|---|---|---|---|

### 期間比較
| 指標 | 前月 | 今月 | 変化率 |
|---|---|---|---|

### 推奨アクション
1. [緊急度: 高] [アクション + 根拠]
2. [緊急度: 中] [アクション + 根拠]
3. [緊急度: 低] [アクション + 根拠]
```

## 注意事項

- 1日単位の変動はノイズが大きい。7日間移動平均で判断する
- 祝日・長期休暇は再生数が自然に増減するため、異常値として過剰に反応しない
- チャンネル登録者数の変動データは DB に蓄積されていないため、YouTube Analytics API (Phase 2) のデータがあればより正確な分析が可能
- 前月比の計算は、比較期間の日数が同じであることを確認する
